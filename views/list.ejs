<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="/main.css" rel="stylesheet">

</head>



<body class="grey-bg">
  <%- include('nav.ejs') %>
  
  <input class="search">
  <button class="search-send">ê²€ìƒ‰</button>

    <div class="white-bg">
      <% for (let i = 0; i < posts.length; i++){ %>
      <div class="list-box">
        <h4>
          <a href="/detail/<%= posts[i]._id %>">
            <%= posts[i].title %>
        </a>
        <a href = "/edit/<%= posts[i]._id %>">âœï¸</a>
        <span class="delete" data-id="<%= posts[i]._id %>">ğŸ—‘ï¸</span>
       </h4>
        <p><%= posts[i].content %></p>
      </div>
  <%  }  %> 
</div>
<% if (posts.length > 0) { %>
<a href="/list/next/<%= posts[posts.length - 1]._id%>">ë‹¤ìŒ</a>
<a href = "/list/back/">ì´ì „</a>
<%} else {%>
  <p>ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
  <a href = "/list/back/">ì´ì „</a>
<% } %>

<>

<!---->

    <!--ë‹¤ìŒì€ AJAX ì‚¬ìš©ë²•-->
<!--ê¸°ë³¸ì ì¸ ìë°” ìŠ¤í¬ë¦½íŠ¸ ë¬¸ë²•-->
<!--1.ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ê³  ë‚œ ë’¤ ì— ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì ˆ ì…ë ¥-->
<!--querySelectorAll : ì›í•˜ëŠ” HTMLìš”ì†Œë¥¼ ì°¾ìŒ-->
<!--addEventListener : í´ë¦­ì‹œ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œ ì‹¤í–‰-->    
   <script>
    for (let i = 0; i < '<%= posts.length %>'; i++){
    // "deleteë¼ëŠ” í´ë˜ìŠ¤ëª…ì„ ê°€ì§„ ì—¬ëŸ¬ html ìš”ì†Œ ì¤‘ 0ë²ˆì§¸ë¥¼ ì°¾ì•„ì„œ í´ë¦­ì‹œ fetch() ì‹¤í–‰í•´ë¼ë¼ëŠ” ëœ»
    document.querySelectorAll('.delete')[i].addEventListener('click',function(e){
    //fetch GET,POST,PUT,DELETE    
    // 1.GET: fetch ê´„í˜¸ì•ˆì— urlì„ ì ìœ¼ë©´ í•´ë‹¹ URLë¡œ GETìš”ì²­ì´ ë‚ ë¼ê° very easy
    // 2.POST: í•´ë‹¹ URLì„ ê´„í˜¸ì•ˆì— ì ê³  ì¤‘ê´„í˜¸ë¥¼ ì—´ê³  ê°’ì„ ë„£ìœ¼ë©´ ë¨ ì•„ë˜ ì˜ˆì‹œ
    fetch('/delete?docid=' + e.target.dataset.id, {
      method : 'DELETE',
      })
      //21.ì‚­ì œê¸°ëŠ¥ë§Œë“¤ê¸° 3
      //ajaxì‚¬ìš©ì‹œ ì„œë²„ê°€ ë³´ë‚¸ ë°ì´í„°ë„ ì¶œë ¥ê°€ëŠ¥
      .then((r)=>r.text()) // ì„œë²„ê°€ ë³´ë‚´ëŠ”ê²Œ ë¬¸ìì¼ ê²½ìš° .text
      .then((r)=>{
        //parentElement.parentElement : ë¶€ëª¨ì˜ ë¶€ëª¨ ìš”ì†Œ ì¦‰ ê¸€ëª©ë¡ 1ì¹¸ì˜ divë¥¼ ë§í•¨
        e.target.parentElement.parentElement.style.display='none'
      }) 
      //ì´ì˜ê²Œ htmlë§Œë“¤ì–´ì„œ í˜„ì¬ í˜ì´ì§€ ë³´ì—¬ì£¼ì„¸ìš”

    })
  }
    //ì„œë²„ë¡œ ë°ì´í„° ë³´ë‚´ëŠ” ë‹¤ë¥¸ ë°©ë²• 2ê°€ì§€
    // 1. querystring
    // 2. URLparameter
   </script>

<script>

  document.querySelector('.search-send').addEventListener('click', function
  (){
    let ì…ë ¥í•œê±° = document.querySelector('.search').value // inputì— ì…ë ¥í•œ ê°’ì´ ë‚˜ì˜´ ì¦‰! ì°¾ê³ ì í•˜ëŠ” ê²€ìƒ‰ì–´ê°€ ë‚˜ì˜´
    location.href = '/search?val=' + ì…ë ¥í•œê±° // URLë¡œ ì´ë™í•´ ì£¼ì„¸ìš” ë¼ëŠ” ëœ»
  })

</script>

  </body>
</html>